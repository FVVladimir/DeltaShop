import React from 'react'
import { connect } from 'react-redux'
import * as R from 'ramda'
import { Link } from 'react-router-dom'

import IconButton from '@material-ui/core/IconButton'
import Typography from '@material-ui/core/Typography'
import { red, green, brown, deepOrange, blue } from '@material-ui/core/colors'
import Button from '@material-ui/core/Button'
import Grid from '@material-ui/core/Grid'
import Card from '@material-ui/core/Card'
import CardMedia from '@material-ui/core/CardMedia'
import { DeleteForever, Clear, Drafts } from '@material-ui/icons'
import { makeStyles } from '@material-ui/core/styles'
import Divider from '@material-ui/core/Divider'
import Paper from '@material-ui/core/Paper'

import {
  getBasketPhonesWithCount,
  getTotalBasketPrice
} from 'selectors'

import { 
  removePhoneFromBasket,
  basketCheckuot,
  cleanBasket
} from 'actions'

const useStyles = makeStyles((theme) => ({
  root: {
    flexDirection: 'column',
    justifyContent: "center",
    alignItems: "center",
  },
  row: {
    flexDirection: 'row',
    justifyContent: "space-around",
    alignItems: "center",
  },
  container: {
    width: '10em',
    height: '12em',
  },
  media: {
    width: '9em',
    height: '12em',
  },
  font: {
    fontWeight: 'bolder',
    fontSize: '1.5em',
  },
  divider: {
    border: `1px solid ${brown[300]}`,
  },
})); 

const Basket = ({
  phones, 
  totalPrice, 
  removePhoneFromBasket,
  basketCheckuot,
  cleanBasket
})=> {
  const classes = useStyles()
  const isBasketEmpty = R.isEmpty(phones)
  const renderContent = ()=> (
    <Grid container className={classes.root} style={{}}>
      {isBasketEmpty && <Typography 
                                    component='div' 
                                    style={{ fontWeight: 'bolder', fontSize: '2.5em', color: red[500]}}
                        >
                          Your shopping cart is empty
                        </Typography>}
          <Grid container className={classes.root} style={{ background: brown[600], borderRadius: '1em'}}>
            {phones.map((phone, index) => (
              <Card key={index} style={{width: '98%', margin: '.15em'}}>
                <Grid container className={classes.row}>
                  
                  <Grid container classes={{root: classes.root, container: classes.container}} style={{width: '16em'}}>
                    <Typography variant='subtitle1' component='div' className={classes.font} style={{ color: brown[600]}}>
                      {phone.name}
                    </Typography>
                    <Typography component='div' className={classes.font} style={{color: green['A700'], fontSize: '1.7em'}}>
                      ${phone.price}
                    </Typography>
                  </Grid>

                  <Divider className={classes.divider} orientation="vertical" flexItem />

                  <CardMedia 
                    image={phone.image}
                    title={phone.name}
                    className={classes.media}
                  />

                  <Divider className={classes.divider} orientation="vertical" flexItem />

                  <Grid container classes={{root: classes.root, container: classes.container}}>
                    <Typography variant='subtitle1' component='h5' style={{marginBottom: '.5em'}}>
                        amount
                    </Typography>
                    <Typography component='div' className={classes.font} style={{ color: red[500]}}>
                        {phone.count}
                    </Typography>
                  </Grid>

                  <Grid container classes={{root: classes.root, container: classes.container}}>
                    <IconButton 
                      onClick={()=> removePhoneFromBasket(phone.id)}
                    >
                      <Clear style={{ fontSize: '1.5em' }}/>
                    </IconButton>
                  </Grid>
                </Grid>
              </Card>
            ))}
          </Grid>
    </Grid>
  )
  
  const renderSidebar = ()=> (
    <Grid container direction='column' justify='space-around' alignItems='center' style={{height: '30em', background: '#fef9f8'}}>
      <Button variant="outlined" style={{background: blue[50]}}>
        <Link
              to='/' 
              style={{textDecoration: 'none', color: green['A700']}}
        >
          <Typography component='span' className={classes.font}>Continue shopping!</Typography>
        </Link>
      </Button>
      {R.not(isBasketEmpty) &&
          <Grid container derection='column' justify='center' alignItems='center' style={{width: '95%', height: '20em', border: `2px solid ${brown[300]}`, borderRadius: '.7em'}}>
            <Button
                    variant='outlined'
                    onClick={cleanBasket}
                    style={{fontWeight: 'bolder', background: blue[50]}}
            >
              <Grid container derection='row' justify='space-between' alignItems='center' style={{width: '100%'}}>
                <Typography component="div" style={{marginTop: '.2em', color: red[500]}}>Clean cart</Typography>
                <DeleteForever style={{fontSize: '2em', color: deepOrange[300], marginLeft: '.5em'}}/>
              </Grid>
            </Button>

            <Typography component='div' style={{width: '100%'}}>
              <Grid container derection='row' justify='center' alignItems='center'>
                <Typography component='div' className={classes.font} style={{marginRight: '.5em', color: red[500]}}>Total:</Typography>
                <Typography component='div' className={classes.font} style={{color: green['A700']}}>${totalPrice}</Typography>
              </Grid>
            </Typography>

            <Button
                    variant='outlined'
                    onClick={()=> basketCheckuot(phones)}
                    style={{fontWeight: 'bolder', background: blue[50]}}
            >
              <Grid container derection='row' justify='space-between' alignItems='center' style={{width: '100%'}}>
                <Typography component="div" className={classes.font} style={{ color: blue['A700']}}>Checkout</Typography>
                <Drafts style={{fontSize: '2em', color: deepOrange[300], marginLeft: '.5em'}}/>
              </Grid>
            </Button>
          </Grid>
      }
    </Grid>
  )

  return (
    <Grid container direction='column' justify='center' alignItems='flex-start' style={{width: '93em',}}>
      <Grid container className={classes.root} style={{width: '60em', marginLeft: '1.5em'}}>
        {renderContent()}
      </Grid>
      <Paper 
        elevation={10}
        style={{width: '20em', paddingTop: '.25em', paddingBottom: '.25em',  position: 'fixed', top: 10, right: 10, background: brown[800]}}
      >
        <Grid container className={classes.root} style={{width: '100%',}}>
          {renderSidebar()}
        </Grid>
      </Paper>
    </Grid>
  )
}

const mapStateToProps = state => {
  return {
    phones: getBasketPhonesWithCount(state),
    totalPrice: getTotalBasketPrice(state)
  }
}

const mapDispatchToProps = {
  removePhoneFromBasket,
  basketCheckuot,
  cleanBasket
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)